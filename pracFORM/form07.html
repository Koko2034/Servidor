<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script type="text/javascript" src="../js/jquery-3.1.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB0sXA3G8vzWU5ZeB-CTsRSLF4i9F64e8M&callback=initMap" defer></script>
    

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>



    <title>Form07</title>
    <style>
    header{
      font-size: 40px;
      margin-top:30px;
      margin-bottom: 20px;
      text-align:center;
    }
    #divTable{
      display:none;
    }
    .map{
        min-width:400px;
        min-height:400px;
        width: 85%;
    }
    .rowMapa{
      margin-left:10%;
      margin-right:-20%;
    }
    .divMapa{
      margin: 0 auto;
    
      
    }
    </style>
</head>
<body>
        <header>Distancias al politecnico</header>
        <div class="container" id="divForm">
        <form class="form-horizontal" method="POST" enctype="application/x-www-form-urlencoded" action="form07.php" id="frmData">
                <div class="form-group">
                  <label class="control-label col-sm-2" for="txtNombre">Nombre:</label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control"  id="txtNombre" name="txtNombre" placeholder="Introduzca su nombre" required>
                  </div>
                </div>
                <div class="form-group">
                  <label class="control-label col-sm-2" for="txtLat">Latitud:</label>
                  <div class="col-sm-10"> 
                    <input type="number" class="form-control" max="180" min="-180" step="any" id="txtLat" name="txtLat" placeholder="Introduzca latitud" required>
                  </div>
                </div>
                <div class="form-group">
                        <label class="control-label col-sm-2" for="txtLon">Longitud:</label>
                        <div class="col-sm-10"> 
                          <input type="number" class="form-control" max="180" min="-180" step="any" id="txtLon" name="txtLon" placeholder="Introduzca longitud" required>
                        </div>
                      </div>
                <div class="form-group"> 
                  <div class="col-sm-offset-2 col-sm-10">
                  
                    <button type="submit" class="btn btn-default" data-toggle="modal" data-target="#myModal">Introducir</button>

                    <!-- Modal -->
                    <div class="modal fade" id="myModal" role="dialog">
                        <div class="modal-dialog">
                        
                          <!-- Modal content-->
                          <div class="modal-content">
                            <div class="modal-header">
                              <button type="button" class="close" data-dismiss="modal">&times;</button>
                              <h4 class="modal-title">Informacion</h4>
                            </div>
                            <div class="modal-body">
                              <p>Sus datos han sido enviados</p>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                          </div>
                          
                        </div>
                      </div>







                    <button type="button" id="butConsult" class="btn btn-default">Consultar</button>
                  </div>
                </div>
              </form>
        </div>
        <div class="container" id="divTable">
          <div id="divInfo"></div>
            <div class="form-group">
              <div class="col-sm-offset-2 col-sm-10">
                  <button type="button" class="btn btn-default" id="butBack">Volver</button>
              </div>
            </div>
        </div>    
        <div class="container divMapa">
            <div class="rowMapa">

                    <div id="map" class="map"></div>
            </div>
                
            </div>          
</body>
<script>
   var form = $('#frmData');
        $( document ).ready(function() {
          $.ajax(
                    {
                    url : 'form07.php',
                    type: 'POST',
                    data : {
                        'texto': 'inicio' 
                    },
                    success:function(data){
                      data = JSON.parse(data);
                      if(data.mensaje==='no existe'){
                        $("#butConsult").prop('disabled',true);
                      }
                    }
                    })
            });
       
        form.submit(function (event) {
            event.preventDefault();
            var formData = new FormData($(this)[0]);
            formData.append('texto','crear');
            $.ajax({
                url: form.attr('action'),
                type: 'POST',
                data: formData,
                async: false,
                cache: false,
                contentType: false,
                processData: false,
                success: function (returndata) {
                  returndata=JSON.parse(returndata);
                  console.log(returndata)
                    if(returndata.mensaje==='existe'){
                      $("#butConsult").prop('disabled',false);
                    }
                  
                }
            });
        });
        $("#butConsult").click(function () {
            $.ajax(
                    {
                    url : 'form07.php',
                    type: 'POST',
                    data : {
                        'texto': 'check' 
                    },
                    success:function(data){
                      data = JSON.parse(data);
                      showTable(data);
                      $("#divForm").css('display',"none");
                      $(".divMapa").css('display',"none");
                      $("#divTable").css('display',"block");
                     
                    
                    
                    }
                    })
        });

        $("#butBack").click(function () {
          $("#divForm").css('display',"block");
            $("#divTable").css('display',"none");
            $(".divMapa").css('display',"block");
        });

        
        function showTable(data){
          str='<table class="table"><thead><tr><th>Nombre</th><th>Distancia politecnico</th></tr></thead><tbody>';
       
         for(k in data){
      
            str+='<tr><td>'+data[k].nombre+'</td><td>'+data[k].distancia+'</td></tr>';
          }
          str+='</tbody></table>';

          $('#divInfo').html(str);
        }
        function initMap() {
        let markers=[];
        var map = new google.maps.Map(document.getElementById('map'), {
            center: {
                lat: 36.7152,
                lng: -4.4282
            },
            zoom: 10
        });
        google.maps.event.addListener(map, 'click', function (event) {
        
            if(markers.length>0){
                markers[0].setMap(null); 
                markers.pop();
            }       
            marker = new google.maps.Marker({position: event.latLng, map: map});
            lat = marker.position.lat().toFixed(4);
            lon = marker.position.lng().toFixed(4);
            
           markers.push(marker);

               txtLat.value = lat;
                txtLon.value = lon;
           
        });
    }
</script>
</html>